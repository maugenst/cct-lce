CctLce=(()=>{"use strict";var t={599:t=>{const{AbortController:e,AbortSignal:n}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;t.exports=e,t.exports.AbortSignal=n,t.exports.default=e},300:(t,e)=>{var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();t.exports=e=n.fetch,n.fetch&&(e.default=n.fetch.bind(n)),e.Headers=n.Headers,e.Request=n.Request,e.Response=n.Response},623:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{s(r.next(t))}catch(t){a(t)}}function c(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.CCT=void 0;var a=n(300),o=n(940),c=n(944),s=function(){function t(t){var e=t.regions;this.finishedLatency=!1,this.finishedBandwidth=!1,this.regions=e||[]}return t.prototype.fetchDatacenterInformation=function(t){return r(this,void 0,void 0,(function(){var e,n=this;return i(this,(function(r){switch(r.label){case 0:if(!t)throw new Error("Datacenter URL missing.");return[4,a.default(t).then((function(t){return t.json()}))];case 1:return e=r.sent(),this.datacenters=this.regions?e.filter((function(t){return n.mapDatacentersOnRegions(t)})):e,this.clean(),this.lce=new o.LCE({datacenters:this.datacenters}),[2]}}))}))},t.prototype.mapDatacentersOnRegions=function(t){return this.regions.map((function(e){return t.name.toLowerCase()===e.toLowerCase()})).reduce((function(t,e){return t||e}))},t.prototype.stopMeasurements=function(){this.lce.terminate()},t.prototype.startLatencyChecks=function(t){var e=this;this.startMeasurementForLatency(t).then((function(){e.finishedLatency=!0}))},t.prototype.startMeasurementForLatency=function(t){return r(this,void 0,void 0,(function(){var e,n,r,a;return i(this,(function(o){switch(o.label){case 0:e=0,o.label=1;case 1:if(!(e<t))return[3,6];n=function(t){var e,n,a;return i(this,(function(i){switch(i.label){case 0:return e=r.datacenters[t],[4,r.lce.getLatencyForId(e.id)];case 1:return(n=i.sent())&&n.latency&&(a=r.datacenters.findIndex((function(t){return t.id===e.id})),null===(i=r.datacenters[a].latencies)||void 0===i||i.push(n.latency),r.datacenters[a].averageLatency=c.Util.getAverageLatency(r.datacenters[a].latencies)),[2]}}))},r=this,a=0,o.label=2;case 2:return a<this.datacenters.length?[5,n(a)]:[3,5];case 3:o.sent(),o.label=4;case 4:return a++,[3,2];case 5:return e++,[3,1];case 6:return[2]}}))}))},t.prototype.startBandwidthChecks=function(t,e){var n=this;this.startMeasurementForBandwidth(t,e).then((function(){n.finishedBandwidth=!0}))},t.prototype.startMeasurementForBandwidth=function(t,e){var n;return r(this,void 0,void 0,(function(){var r,a,o;return i(this,(function(i){switch(i.label){case 0:r=0,i.label=1;case 1:return r<e?[4,this.lce.getBandwidthForId(t.id)]:[3,4];case 2:(a=i.sent())&&a.bandwidth&&(o=this.datacenters.findIndex((function(e){return e.id===t.id})),null===(n=this.datacenters[o].bandwidths)||void 0===n||n.push(a.bandwidth),this.datacenters[o].averageBandwidth=c.Util.getAverageBandwidth(this.datacenters[o].bandwidths)),i.label=3;case 3:return r++,[3,1];case 4:return[2]}}))}))},t.prototype.getCurrentDatacentersSorted=function(){return c.Util.sortDatacenters(this.datacenters),this.datacenters},t.prototype.clean=function(){this.datacenters.forEach((function(t){t.position=0,t.averageLatency=0,t.averageBandwidth={bitsPerSecond:0,kiloBitsPerSecond:0,megaBitsPerSecond:0},t.latencies=[],t.bandwidths=[]}))},t}();e.CCT=s},940:function(t,e,n){var r=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function o(t){try{s(r.next(t))}catch(t){a(t)}}function c(t){try{s(r.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,c)}s((r=r.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function c(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=e.call(t,o)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.LCE=void 0;var a=n(300),o=n(599),c=function(){function t(t){var e=t.datacenters,n=t.agent;this.datacenters=e,this.agent=n,this.cancelableLatencyRequests=[],this.cancelableBandwidthRequests=[],this.terminateAllCalls=!1}return t.prototype.runLatencyCheckForAll=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,a=this;return i(this,(function(i){switch(i.label){case 0:return t=[],this.datacenters.forEach((function(e){t.push(a.getLatencyFor(e))})),[4,t];case 1:return e=i.sent(),[4,Promise.all(e)];case 2:return n=i.sent(),(r=n.filter((function(t){return null!==t}))).sort(this.compare),this.cancelableLatencyRequests=[],[2,r]}}))}))},t.prototype.runBandwidthCheckForAll=function(){return r(this,void 0,void 0,(function(){var t,e,n,r,a,o;return i(this,(function(i){switch(i.label){case 0:i.trys.push([0,5,,6]),t=[],e=0,n=this.datacenters,i.label=1;case 1:return e<n.length?(r=n[e],this.terminateAllCalls?[3,4]:[4,this.getBandwidthFor(r)]):[3,4];case 2:a=i.sent(),t.push(a),i.label=3;case 3:return e++,[3,1];case 4:return(o=t.filter((function(t){return null!==t}))).sort(this.compare),this.cancelableBandwidthRequests=[],[2,o];case 5:return i.sent(),[2,null];case 6:return[2]}}))}))},t.prototype.getBandwidthForId=function(t){var e=this.datacenters.find((function(e){return e.id===t}));return e?this.getBandwidthFor(e):null},t.prototype.getLatencyForId=function(t){var e=this.datacenters.find((function(e){return e.id===t}));return e?this.getLatencyFor(e):null},t.prototype.getLatencyFor=function(t){return r(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=Date.now(),[4,this.latencyFetch("https://"+t.ip+"/drone/index.html")];case 1:return r.sent(),n=Date.now(),[2,{id:t.id,latency:n-e,cloud:t.cloud,name:t.name,town:t.town,country:t.country,latitude:t.latitude,longitude:t.longitude,ip:t.ip,timestamp:Date.now()}];case 2:return r.sent(),[2,null];case 3:return[2]}}))}))},t.prototype.getBandwidthFor=function(e){return r(this,void 0,void 0,(function(){var n,r,a,o,c;return i(this,(function(i){switch(i.label){case 0:return n=Date.now(),[4,this.bandwidthFetch("https://"+e.ip+"/drone/big")];case 1:return null===(r=i.sent())?[3,3]:(a=Date.now(),[4,r.text()]);case 2:return o=i.sent(),c=t.calcBandwidth(o.length,a-n),[2,{id:e.id,bandwidth:c,cloud:e.cloud,name:e.name,town:e.town,country:e.country,latitude:e.latitude,longitude:e.longitude,ip:e.ip}];case 3:return[2,null]}}))}))},t.prototype.bandwidthFetch=function(t){var e=new o.default,n=e.signal;return this.cancelableBandwidthRequests.push(e),this.abortableFetch(t,n)},t.prototype.latencyFetch=function(t){var e=new o.default,n=e.signal;return this.cancelableLatencyRequests.push(e),this.abortableFetch(t,n)},t.prototype.abortableFetch=function(t,e){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,a.default(t,{signal:e})];case 1:return[2,r.sent()];case 2:return n=r.sent(),console.log(n),[2,null];case 3:return[2]}}))}))},t.prototype.compare=function(t,e){return t.latency<e.latency?-1:t.latency>e.latency?1:0},t.prototype.terminate=function(){this.terminateAllCalls=!0,this.cancelableLatencyRequests.forEach((function(t){t.abort()})),this.cancelableBandwidthRequests.forEach((function(t){t.abort()})),this.cancelableLatencyRequests=[],this.cancelableBandwidthRequests=[],this.terminateAllCalls=!1},t.calcBandwidth=function(t,e){var n=8*t/(e/1e3),r=n/1e3;return{bitsPerSecond:n,kiloBitsPerSecond:r,megaBitsPerSecond:r/1e3}},t}();e.LCE=c},944:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Util=void 0;var n=function(){function t(){}return t.deepCopy=function(t){return JSON.parse(JSON.stringify(t))},t.getAverageLatency=function(t){return t?t.reduce((function(t,e){return t+e}),0)/t.length:-1},t.getAverageBandwidth=function(t){if(t){var e=t.reduce((function(t,e){return{bitsPerSecond:t.bitsPerSecond+e.bitsPerSecond,kiloBitsPerSecond:t.kiloBitsPerSecond+e.kiloBitsPerSecond,megaBitsPerSecond:t.megaBitsPerSecond+e.megaBitsPerSecond}}));return{bitsPerSecond:e.bitsPerSecond/t.length,kiloBitsPerSecond:e.kiloBitsPerSecond/t.length,megaBitsPerSecond:e.megaBitsPerSecond/t.length}}return{bitsPerSecond:-1,kiloBitsPerSecond:-1,megaBitsPerSecond:-1}},t.sortDatacenters=function(t){return t.sort((function(t,e){return t.averageLatency-e.averageLatency})),t.forEach((function(t,e){t.position=e+1})),t},t.getTop3=function(e){return t.sortDatacenters(e).slice(0,3)},t.sleep=function(t){return new Promise((function(e){return setTimeout(e,t)}))},t}();e.Util=n}},e={};return function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{}};return t[r].call(i.exports,i,i.exports,n),i.exports}(623)})();
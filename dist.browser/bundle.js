CctLce=(()=>{"use strict";var e={599:e=>{const{AbortController:t,AbortSignal:n}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;e.exports=t,e.exports.AbortSignal=n,e.exports.default=t},300:(e,t)=>{var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response},898:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.Speed=void 0,(n=t.Speed||(t.Speed={})).good="GOOD",n.ok="OK",n.bad="BAD",n.nothing="NOTHING"},623:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}s((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.CCT=void 0;var i=n(300),o=n(898),c=n(940),s=n(944),u=function(){function e(e){var t=e.regions;this.finishedLatency=!1,this.finishedBandwidth=!1,this.regions=t||[]}return e.prototype.fetchDatacenterInformation=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return a(this,(function(r){switch(r.label){case 0:if(!e)throw new Error("Datacenter URL missing.");return[4,i.default(e).then((function(e){return e.json()}))];case 1:return t=r.sent(),this.datacenters=this.regions?t.filter((function(e){return n.mapDatacentersOnRegions(e)})):t,this.clean(),this.lce=new c.LCE({datacenters:this.datacenters}),[2]}}))}))},e.prototype.mapDatacentersOnRegions=function(e){return this.regions.map((function(t){return e.name.toLowerCase()===t.toLowerCase()})).reduce((function(e,t){return e||t}))},e.prototype.stopMeasurements=function(){this.lce.terminate()},e.prototype.startLatencyChecks=function(e){var t=this;this.startMeasurementForLatency(e).then((function(){t.finishedLatency=!0}))},e.prototype.startMeasurementForLatency=function(e){return r(this,void 0,void 0,(function(){var t,n,r,i;return a(this,(function(o){switch(o.label){case 0:t=0,o.label=1;case 1:if(!(t<e))return[3,6];n=function(e){var t,n,i,o;return a(this,(function(a){switch(a.label){case 0:return t=r.datacenters[e],[4,r.lce.getLatencyForId(t.id)];case 1:return(n=a.sent())&&n.latency&&(i=r.datacenters.findIndex((function(e){return e.id===t.id})),null===(a=r.datacenters[i].latencies)||void 0===a||a.push(n.latency),o=s.Util.getAverageLatency(r.datacenters[i].latencies),r.datacenters[i].averageLatency=o,r.datacenters[i].latencyJudgement=r.judgeLatency(o)),[2]}}))},r=this,i=0,o.label=2;case 2:return i<this.datacenters.length?[5,n(i)]:[3,5];case 3:o.sent(),o.label=4;case 4:return i++,[3,2];case 5:return t++,[3,1];case 6:return[2]}}))}))},e.prototype.startBandwidthChecks=function(e,t){var n=this;this.startMeasurementForBandwidth(e,t).then((function(){n.finishedBandwidth=!0}))},e.prototype.startMeasurementForBandwidth=function(e,t){var n;return r(this,void 0,void 0,(function(){var r,i,o,c;return a(this,(function(a){switch(a.label){case 0:r=0,a.label=1;case 1:return r<t?[4,this.lce.getBandwidthForId(e.id)]:[3,4];case 2:(i=a.sent())&&i.bandwidth&&(o=this.datacenters.findIndex((function(t){return t.id===e.id})),null===(n=this.datacenters[o].bandwidths)||void 0===n||n.push(i.bandwidth),c=s.Util.getAverageBandwidth(this.datacenters[o].bandwidths),this.datacenters[o].averageBandwidth=c,this.datacenters[o].bandwidthJudgement=this.judgeBandwidth(c)),a.label=3;case 3:return r++,[3,1];case 4:return[2]}}))}))},e.prototype.judgeLatency=function(e){return e<170?o.Speed.good:e>=170&&e<280?o.Speed.ok:o.Speed.bad},e.prototype.judgeBandwidth=function(e){return e.megaBitsPerSecond>1?o.Speed.good:e.megaBitsPerSecond<=1&&e.megaBitsPerSecond>.3?o.Speed.ok:o.Speed.bad},e.prototype.getCurrentDatacentersSorted=function(){return s.Util.sortDatacenters(this.datacenters),this.datacenters},e.prototype.clean=function(){this.datacenters.forEach((function(e){e.position=0,e.averageLatency=0,e.averageBandwidth={bitsPerSecond:0,kiloBitsPerSecond:0,megaBitsPerSecond:0},e.latencies=[],e.bandwidths=[]}))},e}();t.CCT=u},940:function(e,t,n){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{s(r.next(e))}catch(e){i(e)}}function c(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,c)}s((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((a=(a=o.trys).length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LCE=void 0;var i=n(300),o=n(599),c=function(){function e(e){var t=e.datacenters,n=e.agent;this.datacenters=t,this.agent=n,this.cancelableLatencyRequests=[],this.cancelableBandwidthRequests=[],this.terminateAllCalls=!1}return e.prototype.runLatencyCheckForAll=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i=this;return a(this,(function(a){switch(a.label){case 0:return e=[],this.datacenters.forEach((function(t){e.push(i.getLatencyFor(t))})),[4,e];case 1:return t=a.sent(),[4,Promise.all(t)];case 2:return n=a.sent(),(r=n.filter((function(e){return null!==e}))).sort(this.compare),this.cancelableLatencyRequests=[],[2,r]}}))}))},e.prototype.runBandwidthCheckForAll=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,i,o;return a(this,(function(a){switch(a.label){case 0:a.trys.push([0,5,,6]),e=[],t=0,n=this.datacenters,a.label=1;case 1:return t<n.length?(r=n[t],this.terminateAllCalls?[3,4]:[4,this.getBandwidthFor(r)]):[3,4];case 2:i=a.sent(),e.push(i),a.label=3;case 3:return t++,[3,1];case 4:return(o=e.filter((function(e){return null!==e}))).sort(this.compare),this.cancelableBandwidthRequests=[],[2,o];case 5:return a.sent(),[2,null];case 6:return[2]}}))}))},e.prototype.getBandwidthForId=function(e){var t=this.datacenters.find((function(t){return t.id===e}));return t?this.getBandwidthFor(t):null},e.prototype.getLatencyForId=function(e){var t=this.datacenters.find((function(t){return t.id===e}));return t?this.getLatencyFor(t):null},e.prototype.getLatencyFor=function(e){return r(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=Date.now(),[4,this.latencyFetch("https://"+e.ip+"/drone/index.html")];case 1:return r.sent(),n=Date.now(),[2,{id:e.id,latency:n-t,cloud:e.cloud,name:e.name,town:e.town,country:e.country,latitude:e.latitude,longitude:e.longitude,ip:e.ip,timestamp:Date.now()}];case 2:return r.sent(),[2,null];case 3:return[2]}}))}))},e.prototype.getBandwidthFor=function(t){return r(this,void 0,void 0,(function(){var n,r,i,o,c;return a(this,(function(a){switch(a.label){case 0:return n=Date.now(),[4,this.bandwidthFetch("https://"+t.ip+"/drone/big")];case 1:return null===(r=a.sent())?[3,3]:(i=Date.now(),[4,r.text()]);case 2:return o=a.sent(),c=e.calcBandwidth(o.length,i-n),[2,{id:t.id,bandwidth:c,cloud:t.cloud,name:t.name,town:t.town,country:t.country,latitude:t.latitude,longitude:t.longitude,ip:t.ip}];case 3:return[2,null]}}))}))},e.prototype.bandwidthFetch=function(e){var t=new o.default,n=t.signal;return this.cancelableBandwidthRequests.push(t),this.abortableFetch(e,n)},e.prototype.latencyFetch=function(e){var t=new o.default,n=t.signal;return this.cancelableLatencyRequests.push(t),this.abortableFetch(e,n)},e.prototype.abortableFetch=function(e,t){return r(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,i.default(e,{signal:t})];case 1:return[2,r.sent()];case 2:return n=r.sent(),console.log(n),[2,null];case 3:return[2]}}))}))},e.prototype.compare=function(e,t){return e.latency<t.latency?-1:e.latency>t.latency?1:0},e.prototype.terminate=function(){this.terminateAllCalls=!0,this.cancelableLatencyRequests.forEach((function(e){e.abort()})),this.cancelableBandwidthRequests.forEach((function(e){e.abort()})),this.cancelableLatencyRequests=[],this.cancelableBandwidthRequests=[],this.terminateAllCalls=!1},e.calcBandwidth=function(e,t){var n=8*e/(t/1e3),r=n/1e3;return{bitsPerSecond:n,kiloBitsPerSecond:r,megaBitsPerSecond:r/1e3}},e}();t.LCE=c},944:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Util=void 0;var n=function(){function e(){}return e.deepCopy=function(e){return JSON.parse(JSON.stringify(e))},e.getAverageLatency=function(e){return e?e.reduce((function(e,t){return e+t}),0)/e.length:-1},e.getAverageBandwidth=function(e){if(e){var t=e.reduce((function(e,t){return{bitsPerSecond:e.bitsPerSecond+t.bitsPerSecond,kiloBitsPerSecond:e.kiloBitsPerSecond+t.kiloBitsPerSecond,megaBitsPerSecond:e.megaBitsPerSecond+t.megaBitsPerSecond}}));return{bitsPerSecond:t.bitsPerSecond/e.length,kiloBitsPerSecond:t.kiloBitsPerSecond/e.length,megaBitsPerSecond:t.megaBitsPerSecond/e.length}}return{bitsPerSecond:-1,kiloBitsPerSecond:-1,megaBitsPerSecond:-1}},e.sortDatacenters=function(e){return e.sort((function(e,t){return e.averageLatency-t.averageLatency})),e.forEach((function(e,t){e.position=t+1})),e},e.getTop3=function(t){return e.sortDatacenters(t).slice(0,3)},e.sleep=function(e){return new Promise((function(t){return setTimeout(t,e)}))},e}();t.Util=n}},t={};return function n(r){if(t[r])return t[r].exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,n),a.exports}(623)})();